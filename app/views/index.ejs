<!--
 * index.ejs
 *
 * Description : Main view (HTML template) of the Dmon application.
 * Project     : Dmon - Docker containers monitor
 * Author      : Olivier Vandamme
 * Copyright   : (c) 2025 Olivier Vandamme
 * License     : MIT (see the LICENSE file at project root)
 *
 * Notes :
 * - EJS template rendered server-side.
 * - Loads scripts: core.js, charts.js, renderer.js, lifecycle.js.
 -->
<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>
        <%= title %>
    </title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js" as="script">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"></noscript>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>

    <div class="header">
        <h1 style="display: flex; justify-content: space-between; align-items: center;">
            <span><i class="fas fa-chart-line"></i> Dmon - Docker containers monitor</span>
            <a id="update-link" href="https://dmon.fr" target="_blank" style="text-decoration: none; display: <%= needUpdate ? 'inline-block' : 'none' %>;">
                <button id="update-button" style="background-color: #007bff; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 5px;">
                    Mise à jour disponible
                </button>
            </a>
        </h1>
        <p class="update-info">
            Realtime monitoring. <span id="last-update">Connecting...</span>
        </p>


    </div>

    <div class="host-stats">
        <div style="display: flex; flex-direction: column; justify-content: center; gap: 10px;">
            <div>
                <h2>Host</h2>
            </div>
            <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                <div><i class="fas fa-server"></i> Host Total RAM: <strong id="host-ram-total"><%= host.totalMemory %></strong> MiB</div>
                <div><i class="fas fa-microchip"></i> CPU Cores: <strong id="host-cpu-cores"><%= host.cpuCores %></strong></div>
            </div>
            <div>
                <i class="fas fa-tasks"></i> Load Average:
                <span class="load-avg-values">
                    <strong id="host-load-1"><%= host.loadAverage[0].toFixed(2) %></strong> (1m)
                    <strong id="host-load-5"><%= host.loadAverage[1].toFixed(2) %></strong> (5m)
                    <strong id="host-load-15"><%= host.loadAverage[2].toFixed(2) %></strong> (15m)
                </span>
            </div>
        </div>
        <div>
            <h3>Host CPU Usage: <span id="host-cpu-value" class="value"><%= host.cpuUsage.toFixed(1) %></span>%</h3>
            <div class="host-cpu-chart-container">
                <div id="host-cpu-chart" style="width: 100%; height: 100%;"></div>
            </div>
        </div>
        <div>
            <h3>Host RAM Usage: <span id="host-ram-val" class="value"><%= host.memoryUsagePercent.toFixed(1) %></span>%</h3>
            <div class="host-cpu-chart-container">
                <div id="host-ram-chart" style="width: 100%; height: 100%;"></div>
            </div>
        </div>
    </div>

    <div class="container-grid" id="container-data">
        <div style="color: var(--secondary-text); padding: 20px;" id="loading-message">
            Loading data... <div class="loader"></div>
        </div>
    </div>

    <!-- Load ECharts async to not block initial render -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js" async id="echarts-script"></script>


    <script src="/js/core.js"></script>
    <script src="/js/charts.js"></script>
    <script src="/js/renderer.js"></script>
    <script src="/js/lifecycle.js"></script>


    <div class="footer">©2025 Olivier Vandamme - v<%= version %>
        <span id="latest-version" style="color: var(--primary-color); margin-left: 15px;">Latest: v<%= latestVersion %></span> | 
    </div>

</body>
</html>